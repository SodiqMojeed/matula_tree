<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Matula Tree Plotter</title>

  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>

  <script>
  async function main() {
    // 1. Load Pyodide
    let pyodide = await loadPyodide();

    // 2. Fetch the Python file from your repo
    // If the file is in the same repo and same branch:
    let response = await fetch('matula.py'); // adjust path if in a folder
    let code = await response.text();

    // 3. Run the Python code in Pyodide
    pyodide.runPython(code);

    // 4. Call a function from the loaded Python code
    // Example: calling square(10) if your functions.py has `def square(x): ...`
    let result = pyodide.runPython('vertices(10)');

    // 5. Display result in HTML
    document.getElementById('output').textContent = 'Result: ' + result;
    }

    // Run the async function
    main();
  </script>


  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      display: flex;
      flex-direction: row;
      gap: 20px;
    }

    /* LEFT PANEL: PROPERTIES TABLE */
    #propertiesPanel {
      width: 300px;
      border: 2px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      height: 500px;
      overflow-y: auto;
    }
    #propertiesPanel h3 {
      text-align: center;
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 5px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }

    /* RIGHT PANEL: TREE AREA */
    #mainPanel {
      flex-grow: 1;
    }
    #cy {
      width: 600px;
      height: 500px;
      border: 2px solid #ccc;
      border-radius: 6px;
      margin-top: 15px;
    }
  </style>
</head>

<body>

<!-- LEFT SIDE: PROPERTIES TABLE -->
<div id="propertiesPanel">
  <h3>Properties</h3>

  <table id="propTable">
    <thead>
      <tr>
        <th>S/N</th>
        <th>Name</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows are inserted dynamically -->
    </tbody>
  </table>
</div>

<!-- RIGHT SIDE: TREE + CONTROLS -->
<div id="mainPanel">
  <h2>Matula Number â†’ Rooted Tree (Interactive)</h2>

  <p>Enter a natural number:</p>
  <input id="numInput" type="number" min="1" value="30" style="width:150px;">
  <button onclick="plot()">Plot Tree</button>
  <button onclick="saveImage()">Save Plot</button>

  <div id="cy"></div>
</div>

<script>
/* ----------------------------------------------------------
   PRIME UTILITIES
---------------------------------------------------------- */
function isPrime(n) {
  if (n < 2) return false;
  if (n % 2 === 0) return n === 2;
  for (let i = 3; i * i <= n; i += 2) {
    if (n % i === 0) return false;
  }
  return true;
}

function primeIndex(p) {
  let count = 0;
  for (let x = 2; x <= p; x++) if (isPrime(x)) count++;
  return count;
}

/* ----------------------------------------------------------
   MATULA TREE BUILDER
---------------------------------------------------------- */
function matulaTree(n) {
  if (n === 1) return { value: 1, children: [] };

  if (isPrime(n)) {
    return { value: n, children: [matulaTree(primeIndex(n))] };
  }

  for (let a = 2; a * a <= n; a++) {
    if (n % a === 0) {
      const b = n / a;
      const left = matulaTree(a);
      const right = matulaTree(b);
      return { value: n, children: [...left.children, ...right.children] };
    }
  }
}

/* ----------------------------------------------------------
   FIXED POSITION TREE LAYOUT (VERTICAL)
---------------------------------------------------------- */
function toCytoscapeElements(tree) {
  let elements = [];
  let id = 0;

  const levels = [];

  function traverse(node, depth = 0) {
    const nodeId = "n" + (id++);
    if (!levels[depth]) levels[depth] = [];
    levels[depth].push(nodeId);

    elements.push({
      data: { id: nodeId, label: node.value }
    });

    node.children.forEach(child => {
      const childId = traverse(child, depth + 1);
      elements.push({
        data: { source: nodeId, target: childId }
      });
    });
    return nodeId;
  }

  traverse(tree);

  const xSpacing = 80;
  const ySpacing = 90;

  levels.forEach((levelNodes, depth) => {
    const startX = -(levelNodes.length - 1) * xSpacing / 2;
    levelNodes.forEach((nodeId, i) => {
      elements.find(e => e.data.id === nodeId).position = {
        x: startX + i * xSpacing,
        y: depth * ySpacing
      };
    });
  });

  return elements;
}

/* ----------------------------------------------------------
   RENDER TREE
---------------------------------------------------------- */
let cy;

function renderTree(elements) {
  cy = cytoscape({
    container: document.getElementById('cy'),
    elements: elements,
    layout: { name: 'preset' },

    style: [
      {
        selector: 'node',
        style: {
          'background-color': '#4A8CF7',
          'width': 28,
          'height': 28,
          'label': 'data(label)',
          'color': 'white',
          'font-size': 12,
          'text-valign': 'center',
          'text-outline-color': '#4A8CF7',
          'text-outline-width': 2
        }
      },
      {
        selector: 'edge',
        style: {
          'width': 2,
          'line-color': '#444',
          'curve-style': 'straight'
        }
      }
    ],

    userZoomingEnabled: true,
    userPanningEnabled: true
  });
}

/* ----------------------------------------------------------
   DUMMY PROPERTY FUNCTIONS
   (You will later replace these with real metrics)
---------------------------------------------------------- */
function computeNodeCount(tree) {
  return "dummy node count";
}

function computeTreeHeight(tree) {
  return "dummy height";
}

function computePrimeFactors(tree) {
  return "dummy factorization";
}

function computeBranchingFactor(tree) {
  return "dummy branching";
}

/* ----------------------------------------------------------
   FILL PROPERTIES TABLE
---------------------------------------------------------- */
function updateProperties(tree) {
  const table = document.querySelector("#propTable tbody");
  table.innerHTML = "";

  const metrics = [
    { name: "Number of nodes", value: computeNodeCount(tree) },
    { name: "Tree height", value: computeTreeHeight(tree) },
    { name: "Prime factors", value: computePrimeFactors(tree) },
    { name: "Branching factor", value: computeBranchingFactor(tree) },
  ];

  metrics.forEach((m, i) => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${m.name}</td>
      <td>${m.value}</td>
    `;

    table.appendChild(row);
  });
}

/* ----------------------------------------------------------
   SAVE IMAGE
---------------------------------------------------------- */
function saveImage() {
  if (!cy) return;

  const png = cy.png({ output: 'blob', full: true, scale: 2 });

  const url = URL.createObjectURL(png);
  const a = document.createElement('a');
  a.href = url;
  a.download = "matula_tree.png";
  a.click();
  URL.revokeObjectURL(url);
}

/* ----------------------------------------------------------
   PLOT
---------------------------------------------------------- */
function plot() {
  const n = parseInt(document.getElementById("numInput").value);
  const tree = matulaTree(n);

  updateProperties(tree);

  const elements = toCytoscapeElements(tree);
  renderTree(elements);
}

plot(); // auto-run
</script>

</body>
</html>




